# Wireless and Mobile Networks

## 6.1 Introduction

ในระบบเครือข่ายแบบไร้สายจะมีองค์ประกอบสำคัญดังต่อไปนี้

1. Wireless hosts: เป็นลักษณะของโฮสต์ที่สามารถใช้งานเครือข่ายไร้สายได้ โดยตัวของไวเลสโฮสต์นั้นอาจเป็นอุปกรณ์พกพาหรือไม่ก็ได้
2. Wireless links: เป็นตัวกลางที่ใช้เชื่อมต่อระหว่างโฮสต์กับสถานีของเครือข่ายไร้สาย โดยแต่ละตัวกลางที่ต่างกันก็จะมีประสิทธิภาพในการส่งข้อมูลที่ต่างกัน ซึ่งอาจมีการใช้ในส่วนหลักของเน็ตเวิร์กด้วย เพียงแต่ในบทนี้จะพูดถึงการเชื่อมต่อของโฮสต์เพื่อส่งข้อมูลเท่านั้น
3. Base station: เป็นสิ่งที่สำคัญที่สุดในระบบเครือข่ายแบบไร้สาย สถานีเป็นส่วนที่รับผิดชอบในการรับและส่งข้อมูลจากโฮสต์ผ่านทางลิงก์แบบไร้สาย และยังรับผิดชอบในการจัดการระบบเครือข่ายในกรณีที่มีโฮสต์มากกว่า  โฮสต์เชื่อมต่อกัน ถ้าเราพูดว่าโฮสต์มีการเชื่อมต่อกับสถานีจะหมายความได้สองกรณีคือ
    1. โฮสต์นั้นอยู่ในระยะการสื่อสารแบบไร้สายจากสถานี
    2. โฮสต์มีการใช้สถานีในการถ่ายทอดหรือรับส่งข้อมูลจากตัวมันเองไปยังเครือข่ายที่ใหญ่กว่า
ในเครือข่าย cellular networks เช่นในโทรศัพท์เคลือนที่นั้นจะเรียกสถานีดังกล่าว่า **cell towers** ส่วนในมาตราฐานของ IEEE 802.11 wireless LANs จะเรียกสถานีว่า **access points** 

ตามมาตราฐาน 802.11 wireless LANs นั้นจะมีอยู่สองโหมดปฏิบัติการคือ **ad hoc mode** และ **infrastructure mode** โดยใน ad hoc mode นั้นโฮสต์สามารถติดต่อสื่อสารกันได้แบบ peer-to-peer ซึ่งหมายความว่าโฮสต์จะต้องมีการทำเราท์ติ้งหรือการแปลง DNS ด้วยตัวเอง ในส่วนของ infrastructure mode นั้นโฮสต์จะมีการส่งและรับข้อมูลผ่านทาง access points เพื่อเชื่อมต่อไปยังเครือข่ายอื่นๆ ซึ่งรายละเอียดอื่นๆ นั้นจะอยู่ที่การให้บริการของ access points 

เมื่อโฮสต์หรืออุปกรณ์พกพามีการเคลื่่อนที่หรือย้ายออกจากระยะไร้สายของสถานีหนึ่ง ไปยังระยะการให้บริการของอีกสถานีหนึ่ง ตัวโฮสต์เองจะมีการเปลี่ยนไปใช้อีกเครือข่ายที่สามารถใช้งานได้ (available) โดยอัตโนมัติ กระบวนการนี้เรียกว่า [**handoff (vertical handover)**](https://en.wikipedia.org/wiki/Vertical_handover)

การจะแบ่งประเภทของเครือข่ายไร้สายนั้นจะค่อนข้างหลากหลายตามลักษณะที่เอามาแบ่ง โดยตามหนังสือเล่มนี้นั้นจะใช้หลักเกณฑ์ในการแบ่งเครือข่ายไร้สายออกเป็นสองประเภทคือ

1. ใช้ลักษณะของการส่งข้อมูลในเครือข่ายไร้สายแบบ one hop หรือ multiple hops และ
2. มีการใช้รูปแบบของ infrastructure ซึ่งมีสถานีของเครือข่ายไร้สายอยู่หรือไม่

ซึ่งจากหลักเกณฑ์ดังกล่าวทำให้เราสามารถแบ่งประเภทของเครือข่ายไร้สายได้ออกเป็น 4 ประเภทคือ

1. Single-hop, infrastructure-based: ในเครือข่ายไร้สายประเภทนี้นั้นจะมีสถานีเครือข่ายไร้สายที่เชื่อมต่อไปยังเครือข่ายที่ใหญ่กว่า (ยกตัวอย่างเช่นอินเทอร์เน็ต) นอกจากนี้การติดสื่อสารทั้งหมดระหว่างสถานีและโฮสต์จะอยู่บน single wireless hop เช่น 802.11 และ 3G cellular
2. Single-hop, infrastructure-less: ในเครือข่ายไร้สายประเภทนี้นั้นจะไม่มีสถานไร้สาย อย่างไรก็ตาม โฮสต์ในแต่ละโฮสต์จะเป็นผู้กำหนดรูปแบบของการส่งและรับข้อมูลกับโฮสต์อื่นๆ เอง ในที่นี้เช่น เครือข่าย Blueetooth และเครือข่าย 802.11 ที่อยู่ในโหมด ad hoc
3. Multi-hop, infrastructure-based: ในเครือข่ายไร้สายประเภทนี้นั้น สถานีจะมีการเชื่อมต่อแบบมีสายไปยังเครือข่ายที่ใหญ่กว่า อย่างไรก็ตามโฮสต์ก็ยังสามารถติดต่อสื่อสารกับสถานีได้แบบไร้สาย ตัวอย่างของเครือข่ายไร้สายประเภทนี้ได้แก่เครือข่ายของเซ็นเซอร์ไร้สายซึ่งถูกเรียกว่า wireless mesh networks
4. Multi-hop, infrastructure-less: ในเครือข่ายนี้จะไม่มีสถานี อีกทั้งโฮสต์ก็ต้องมีการส่งข้อมูลกันระหว่างโหนดอื่นๆ เป็นลำดับจนกว่าจะถึงผู้รับ หากโหนดในที่นี้เป็นอุปกรณ์ไร้สายแบบพกพาจะเรียกว่า mobile ad hoc networks (MANETs) หากโหนดในที่นี้อยู่ในรูปแบบของยานพาหนะก็จะเรียกว่า vehicular ad hoc network (VANET)

## 6.2 Wireless Links and Network Characteristics

ปัญหาของลิงก์แบบไร้สายมีดังนี้

- การลดลงของกำลังสัญญาณ: คลื่นแม่เหล็กไฟฟ้านั้นจะมีกำลังลดลงเมื่อเดินทางผ่านวัตถุที่เป็นของแข็ง และจะมีการกระจายเมื่อเดินทางในอากาศ ซึ่งจะทำให้สัญญาณที่ถูกส่งนั้นมีกำลังลดลง (บางครั้งเรียกว่า path loss) เมื่อระยะทางระหว่างผู้ส่งและผู้รับนั้นมีมากขึ้น
- การรบกวนจากแหล่งที่มาอื่น: คลื่นวิทยุนั้นจะมีการส่งข้อมูลในช่องความถี่เดียวกัน และสามารถถูกรบกวนได้ในกรณีที่มีสัญญาณรบกวนตามธรรมชาติในความถี่นี้
- การแพร่กระจายหลายทิศทาง: การแพร่กระจายแบบหลายทิศทาง ([multipath propagation](https://en.wikipedia.org/wiki/Multipath_propagation)) เป็นเหตุการณ์ที่เกิดขึ้นเมื่อคลื่นแม่เหล็กไฟฟ้ามีการสะท้อนกับวัตถุหรือพื้นและมีการกระจายออกเป็นในทิศทางที่แตกต่างกันออกไป

จากกรณีของปัญหาในด้านบนทำให้มาตราฐานของเครือข่ายไร้สาย เช่น 802.11 นั้นมีการตรวจสอบข้อผิดพลาดที่ค่อนข้างรัดกุมและมีโปรโตคอลที่ต้องสร้างความน่าเชื่อถือในการส่งข้อมูล


**Signal-to-noise ratio (SNR)** เป็นอัตราส่วนระหว่างปริมาณความเข้มของสัญญาณที่ได้รับกับสัญญาณรบกวน โดยค่า SNR จะมีหน่วยเป็นเดซิเบล (dB) เนื่องจากในการส่งข้อมูลผ่านทางสัญญาณนั้น จะมีการถูกรบกวนโดยสัญญาณรบกวนตามธรรมชาติอยู่ ซึ่งหากค่า SNR นั้นมีมาก ก็หมายความว่าผู้รับข้อมูลจะสามารถแยกข้อมูลออกจากสัญญาณได้ง่ายยิ่งขึ้น

**Bit error rate (BER)** คือความเป็นไปได้ของเหตุการณ์ที่ผู้รับจะทำการรับข้อมูลแล้วมีช้อผิดพลาด

เทคนิคการ modulation ยังมีต่อคุณลักษณะของเครือข่ายแบบไร้สายด้วย กราฟด้านล่างแสดงให้เห็นถึงความสัมพันธ์ระหว่าง SNR, BER และเทคนิคการ modulation

![Relationship between SNR, BER and modulation techniques](https://lh4.googleusercontent.com/-288QR1PqkSU/UwB87BkQghI/AAAAAAAAFSU/LB-hjT3wZ0c/w608-h493-no/graph.png)

จากรูปสามารถสรุปได้ดังนี้

- การเพิ่มขึ้นของ SNR ทำให้ BER ลดลง โดยการเพิ่ม SNR คือการเพิ่ม transmission power
- การเพิ่มอัตราการส่งข้อมูลให้มากขึ้นทำให้ BER มากขึ้น
- การเลือกรูปแบบของ physical-layer modulation แบบไดนามิกสามารถช่วยในการจัดการเงื่อนไขในการส่งข้อมูลได้

นอกจากปัญหาในเรื่องความผิดพลาดของข้อมูลแล้ว ยังมีปัญหาอื่นๆ อีกที่อาจเกิดขึ้นได้ในระบบเครือข่ายแบบไร้สายเช่น**ปัญหา hidden terminal** ซึ่งอาจทำให้สถานีบางสถานีไม่สามารถรับข้อมูลได้จากสถานีอื่น หรือเข้าไปรบกวนการสื่อสารของสถานีอื่น อีกทั้งปัญหาของการไม่สามารถตรวจจับสถานะของข้อมูลที่เกิดการ fading ของสัญญาณในลิงก์แบบไร้สายได้

### 6.2.1 CDMA

CDMA (Code division multiple) เป็นรูปแบบของการเชื่อมต่อสัญญาณที่มีพื้นฐานมาจาก โปรโตคอลแบบ channel partitioning โดยในแต่ละบิตของข้อมูลที่ถูกส่งจะมีการถูกเข้ารหัสด้วยสัญญาณที่มีการเปลี่ยนแปลงในอัตราที่สูง (เรียกว่า chipping rate) ด้วยวิธีการคูณ ต้นกำหนดของสัญญาณที่ถูกนำมาใช้ในการเข้ารหัสข้อมูลนั้นอาจเกิดขึ้นได้จากการสุ่ม 

สิ่งสำคัญของ CDMA คือผู้ส่งจะต้องมีการเลือกใช้ CDMA codes หรือสัญญาณที่จะมาเข้ารหัสอย่างระมัดระวัง อีกทั้งยังต้องระวังเกี่ยวกับปัญหาในเรื่องสัญญาณที่อ่อนลงเมื่อระยะทางมากขึ้นด้วย

*CDMA ยังอธิบายไม่เพียงพอ แนะนำให้หาอ่านเพิ่มเติม*

## 6.3 WiFi: 802.11 Wireless LANs

มาตราฐานของ wireless LANs หรือแลนแบบไร้สายนั้นมีชื่อเต็มว่า IEEE 802.11 wireless LAN หรือ WiFi โดยตัวมาตราฐาน 802.11 ยังถูกแบ่งออกเป็น 802.11a, 802.11b และ 802.11g อีกด้วย โดยแต่ละรูปแบบก็มีลักษณะเฉพาะที่แตกต่างกัน

มาตราฐาน 802.11 ทั้งหมดมีการใช้โปรโตคอลในการเข้าถึงลิงก์แบบเดียวกันคือ CSMA/CA, มีโครงสร้างของเฟรมใน link-layer เหมือนกัน อีกทั้งทั้งสามรูปแบบของ 802.11 ยังรองรับทั้งโหมดการทำงานแบบ infrastructure และ ad hoc เหมือนกัน

ข้อแตกต่างของแต่ละรูปแบบนั้นจะอยู่ที่อัตราในการส่งข้อมูล และช่วงความถี่ที่ใช้ โดยแยกได้ดังนี้

- 802.11b wireless LANs จะมีอัตราการส่งข้อมูล 11 Mbps และอยู่ในช่วงความถี่ 2.4 - 2.485 GHz ย่านเดียวกับโทรศัพท์เคลื่อนที่และเตาโมโครเวฟ
- 802.11a wireless LANs จะมีระยะทางในการส่งข้อมูลที่สั้นกว่า โดยมีอัตราการส่งข้อมูล 54 Mbps ในช่วงความถี่ 5.1 - 5.8 GHz และมีแนวโน้มที่จะเจอกับปัญหา multipath propagation มากกว่า
- 802.11g wireless LANs มีอัตราการส่งข้อมูลอยู่ที่ 54 Mbps แต่ใช้ช่องความถี่เดียวกันกับ 802.11b คือ 2.4 - 2485 GHz

### 6.3.1 The 802.11 Architecture

Basic service set (BSS) เป็นรูปแบบของการแสดงการทำงานของ 802.11 โดยใน BSS จะประกอบไปด้วย wireless station และ central base station ซึ่งก็คือ access point (AP) เราสามารถที่จะจัดกลุ่ม BSS ที่ไม่มี central base station และไม่มีการเชื่อมต่อออกสู่เครือข่ายภายนอกให้เป็น ad hoc ได้

Wireless station จะเหมือนกับอุปกรณ์ Ethernet คือจะมี MAC address ขนาด 6-byte เก็บอยู่ในเฟิร์มแวร์โดยจะมีคุณลักษณะเหมือนกับ ethernet MAC address ทุกประการ

ในการที่จะกำหนดช่องทางการสื่อสารนั้น จะต้องมีการกำหนดค่าบางส่วนก่อน ดังนี้

1. Service Set Identifier (SSID): เป็นค่าที่ถูกกำหนดให้กับ access point เพื่อระบุ BSS โดยเป็นสตริงขนาดตั้งแต่ 1 ถึง 32 ไบต์ บางครั้งเรียกว่า network name
2. Channel number (optional): เป็นช่องสัญญาณที่จะถูกใช้เพื่อป้องกันการชนกันและการแทรกสอดของเครื่อง ([ดูเพิ่มเติมที่: List of WLAN channels](https://en.wikipedia.org/wiki/List_of_WLAN_channels))

WiFi jungle เป็นสถานที่ทางกายภาพที่ wireless station รับสัญญาณได้จาก AP มากกว่าสองตัวขึ้นไป ดังนั้นเวลาใช้งานจริง โฮสต์จำเป็นที่จะสื่อสารกับ AP ให้ถูกต้องโดยใช้สิ่งที่เรียกว่า **beacon frames** ซึ่งประกอบด้วย SSID และ MAC address ของ AP นั้นๆ 

ตามมาตราฐาน 802.11 นั้นไม่ได้การกำหนดอัลกอริธึมในการเลือก AP เอาไว้ แต่มีการกำหนดอัลกอริธึมไว้กับเฟิร์มแวร์หรือซอฟต์แวร์บางประเภทให้เลือก AP ที่สามารถรับ beacon frames ได้จากสัญญาณที่มีคุณภาพที่สุด แม้ในความเป็นจริงแล้ว AP ที่มีสัญญาณแรงที่สุดอาจไม่สามารถให้บริการได้ดีที่สุดก็ตาม

กระบวนการในการแสกนหาช่องสัญญาณและรอรับ beacon frames รู้จักกันในชื่อว่า **passive scanning** ซึ่งโฮสต์ยังสามารถทำ **active scanning** ได้โดยใช้การบรอดคาสต์เฟรมซึ่งจะถูกรับและตอบโดยใช้เฟรมโดย AP นั้นๆ  โดยจะขอลำดับวิธีการออกดังนี้

Passive scanning
1. เมื่อโฮสต์เข้ามาในระยะของคลื่นสัญญาณแล้ว โฮสต์จะได้รับ beacon frames จาก AP ต่างๆ
2. โฮสต์จะเป็นผู้ตัดสินใจว่าจะใช้ AP ไหนโดยทำการส่ง association request frame ไปยัง AP ที่เลือก
3. AP ที่ถูกเลือกก็จะทำการส่ง association response frame กลับมา

Active scanning
1. โฮสต์จะทำการบรอดคาสต์ probe request frame ออกไปหา AP ที่อยู่ในระยะของคลื่นสัญญา
2. โฮสต์ได้รับ probe response frame จากแต่ละ AP
3. โฮสต์ตัดสินใจเลือก AP และส่ง association request frame ไปยัง AP นั้น
4. AP ตอบกลับมายังโฮสต์ด้วย association response frame

### 6.3.2 The 802.11 MAC Protocol

802.11 wireless LAN ใช้รูปแบบของ random access protocol ซึ่งก็คือ **carrier sense multiple access with collision avoidance (CSMA/CA)** คล้ายกับ Ethernet แต่มีการปรับปรุง MAC Protocol ใหม่คือแทนที่จะใช้ collision detection แต่จะเปลี่ยนไปใช้ collision-avoidance แทน และเนื่องจากการที่ช่องการสื่อสารของเครือข่ายไร้สายนั้นมีโอกาสที่จะผิดพลาดได้มากกว่า Ethernet จึงมีการใช้ link-layer acknowledgement/retransmission (ARQ) scheme ด้วย เหตุผลที่ 802.11 wireless LAN เปลี่ยนมาใช้ collision avoidance นั่นก็เพราะว่า มันเป็นไปได้ยากที่จะตรวจจับการชนกันของข้อมูล และเนื่องจากปัญหา hidden terminal และ fading ด้วย

เมื่อสถานีปลายทางรับเฟรมข้อมูลที่ผ่าน CRC แล้ว มันจะรอเป็นช่วงเวลาที่เรียกว่า **Short Inter-frame Spacing (SIFS)** และจะส่ง acknowledgement หากสถานีที่ทำการส่งข้อมูลไม่ได้รับ acknowledgement ในระยะเวลาที่กำหนด สถานีที่ทำการส่งจะเข้าใจว่าเกิดข้อผิดพลาดและส่งเฟรมนั้นใหม่ จากการใช้ CSMA/CA โปรโตคอล หากสถานีที่ทำการส่งข้อมูลยังคงไม่ได้รับ acknowledgement จากการส่งเฟรมนั้นใหม่อีก มันจะทำการทิ้งเฟรมนั้นไป โดยขั้นตอนทั้งหมดนี้จะเรียกว่า link-layer acknowledgement

ใน 802.11 CSMA/CA โปรโตคอลนั้น จะมีขั้นตอนการทำงานดังนี้
1. หากเป็นการเริ่มต้นส่งในครั้งแรก สถานีที่จะทำการส่งพบว่าช่องทางการส่งนั้นว่าง มันจะทำการส่งเฟรมนั้นหลังจากช่วงเวลาสั้นๆ ที่เรียกว่า distributed inter-frame space (DIFS)
2. สถานีที่จะทำการส่งทำการสุ่มค่าจาก binary exponential backoff หากช่องทางการส่งนั้นยังคงว่างอยู่ ค่านี้จะลดลงเรื่อยๆ จนกระทั่งถึงศูนย์ แต่หากช่องทางการส่งนั้นกำลังถูกใช้งานค่านี้จะไม่ลดลง
3. เมื่อค่าที่จาก binary exponential backoff ลดลงจนเป็นค่าศูนย์แล้ว สถานีจะทำการส่งเฟรมทั้งหมดออกไปและรอรับ acknowledgement
4. หากสถานที่ทำการส่งได้รับ acknowledgement ก็จะถือว่าการส่งนั้นสมบูรณ์และทำการส่งเฟรมถัดไปในขั้นตอนที่ 2 แต่หากสถานีนี้ยังไม่ได้รับ acknowledgement ก็จะทำการเข้าสู่ backoff phase พร้อมกับค่าที่ถูกสุ่มขึ้นใหม่ (ที่มากกว่าเดิม)

สำหรับปัญหาเรื่อง hidden terminal นั้น มีการใช้ Request to Send (RTS) และ Clear to Send (CTS) control frame ในการจองช่องสัญญาณที่จะทำการส่งข้อมูลเพื่อป้องกันการส่งในเวลาเดียวกัน เมื่อผู้ส่งต้องการที่จะส่องข้อมูล มันจะทำการส่ง RTS เฟรมไปยัง AP และ AP ก็จะทำการบรอดคาต์ CTS เพื่อบอกว่าใครจะเป็นผู้ส่งด้วย

